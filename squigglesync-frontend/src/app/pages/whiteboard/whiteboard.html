<div class="relative h-screen w-screen overflow-hidden bg-white">
  <!-- Full-Screen Canvas - Covers entire viewport -->
  <div class="absolute inset-0">
    <!-- Subtle grid pattern background - Covers full viewport -->
    <svg class="absolute inset-0 w-full h-full pointer-events-none" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="grid" x="0" y="0" width="30" height="30" patternUnits="userSpaceOnUse">
          <path d="M 30 0 L 0 0 0 30" fill="none" stroke="#c0c0c0" stroke-width="0.6"/>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#grid)" />
    </svg>
    
    <!-- Canvas Element -->
    <canvas
      #canvas
      class="absolute inset-0 w-full h-full"
      [class.cursor-crosshair]="canvasCursor() === 'cursor-crosshair'"
      [class.cursor-eraser]="canvasCursor() === 'cursor-eraser'"
      [width]="canvasWidth()"
      [height]="canvasHeight()"
      (mousedown)="onMouseDown($event)"
      (mousemove)="onMouseMove($event)"
      (mouseup)="onMouseUp($event)"
      (mouseleave)="onMouseUp($event)"
      (touchstart)="onTouchStart($event)"
      (touchmove)="onTouchMove($event)"
      (touchend)="onTouchEnd($event)"
    ></canvas>
  </div>

  <!-- Floating Header Overlay - Transparent with floating elements -->
  <div class="absolute top-0 left-0 right-0 z-50 pt-3 pb-3 pointer-events-none">
    <div class="flex items-center justify-between px-6 pointer-events-auto">
      <div class="flex items-center gap-4">
        <!-- Sidebar Toggle -->
        <p-button 
          [icon]="sidebarVisible() ? 'pi pi-times' : 'pi pi-bars'"
          [text]="true"
          severity="secondary"
          (onClick)="toggleSidebar()"
          [class]="sidebarToggleClasses()"
          [attr.aria-expanded]="sidebarVisible()"
          aria-label="Toggle sidebar"
        />
        
        <!-- Doodle-style Title -->
        <h1 class="doodle-title text-3xl font-bold text-surface-900 m-0 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-lg shadow-sm">SquiggleSync</h1>
        
        <p-divider layout="vertical" class="h-6 bg-surface-300/50" />
        
        <div class="flex items-center gap-2">
          <input 
            type="text"
            pInputText
            [value]="roomId()" 
            placeholder="Room ID"
            class="w-40 bg-white/90 backdrop-blur-sm border-surface-300 shadow-sm"
            readonly
          />
          <p-button 
            icon="pi pi-copy" 
            [text]="true"
            severity="secondary"
            (onClick)="copyRoomLink()"
            pTooltip="Copy room link"
            aria-label="Copy room link"
            class="text-surface-600 hover:text-surface-900 bg-white/90 backdrop-blur-sm hover:bg-white shadow-sm"
          />
        </div>
      </div>
      
      <div class="flex items-center gap-3">
        <p-tag 
          [value]="connectionStatus()" 
          [severity]="connectionSeverity()"
          [icon]="connectionIcon()"
          class="bg-white/90 backdrop-blur-sm shadow-sm"
        />
        <p-badge [value]="userCount()" severity="info">
          <p-button 
            icon="pi pi-users" 
            [text]="true"
            severity="secondary"
            aria-label="Active users"
            class="text-surface-600 hover:text-surface-900 bg-white/90 backdrop-blur-sm hover:bg-white shadow-sm"
          />
        </p-badge>
      </div>
    </div>
  </div>

  <!-- Floating Sidebar - Modern Design -->
  <div 
    class="absolute top-0 left-0 h-screen z-30 pt-16 transition-all duration-300 ease-in-out"
    [class.translate-x-0]="sidebarVisible()"
    [class.-translate-x-full]="!sidebarVisible()"
    [class.opacity-100]="sidebarVisible()"
    [class.opacity-0]="!sidebarVisible()"
    [class.pointer-events-auto]="sidebarVisible()"
    [class.pointer-events-none]="!sidebarVisible()"
  >
    <div class="w-80 h-full overflow-y-auto px-5 py-6">
      <app-toolbar
        [selectedTool]="selectedTool()"
        [color]="color()"
        [strokeWidth]="strokeWidth()"
        [eraserSize]="eraserSize()"
        (toolChange)="selectTool($event)"
        (colorChange)="updateColor($event)"
        (strokeWidthChange)="updateStrokeWidth($event)"
        (eraserSizeChange)="updateEraserSize($event)"
      />
    </div>
  </div>

  <!-- Name Input Modal -->
  <p-dialog 
    [visible]="showNameModal()"
    (visibleChange)="showNameModal.set($event)"
    [modal]="true"
    [closable]="!!roomLink()"
    [draggable]="false"
    [resizable]="false"
    [style]="{ width: '90%', maxWidth: '520px' }"
    [styleClass]="'name-modal'"
    (onHide)="closeModal()"
  >
    <div class="modal-content-wrapper">
      <!-- Welcome Header - Always visible -->
      <div class="modal-header-content">
        <h2 class="doodle-title text-3xl font-bold text-surface-900 m-0 mb-3">
          @if (roomLink()) {
            Room Created!
          } @else {
            Welcome to SquiggleSync
          }
        </h2>
        @if (!roomLink()) {
          <p class="doodle-text text-base text-surface-600 m-0 leading-relaxed mb-4">
            üé® Your creative playground where ideas come to life! Draw, doodle, and collaborate in real-time with friends. 
            Think of it as a digital whiteboard that never runs out of space... or markers! ‚úèÔ∏è
          </p>
        }
      </div>
      @if (!roomLink()) {
        <!-- Name Input Form -->
        <div class="modal-form">
          <div class="modal-separator"></div>
          <div class="form-group">
            <label for="name-input" class="doodle-label form-label">
              Enter your name
            </label>
            <input
              id="name-input"
              type="text"
              pInputText
              [ngModel]="nameInput()"
              (ngModelChange)="nameInput.set($event)"
              placeholder="Your name"
              class="form-input"
              (keyup.enter)="onSubmitName()"
              autofocus
            />
          </div>
          <p-button
            label="Create Room"
            icon="pi pi-check"
            (onClick)="onSubmitName()"
            [disabled]="!nameInput().trim()"
            class="w-full create-room-button"
            styleClass="p-button-primary"
          />
        </div>
      } @else {
        <!-- Room Link Display -->
        <div class="room-link-section">
          <div class="room-link-container">
            <p class="doodle-text room-link-info">
              <i class="pi pi-info-circle text-primary"></i>
              <span>This is your room link. Share it with others to collaborate and create together! üéâ</span>
            </p>
            <div class="room-link-input-group">
              <input
                type="text"
                pInputText
                [value]="roomLink()"
                readonly
                class="room-link-input"
              />
              <p-button
                [icon]="linkCopied() ? 'pi pi-check' : 'pi pi-copy'"
                [text]="true"
                severity="secondary"
                (onClick)="copyRoomLink()"
                [pTooltip]="linkCopied() ? 'Copied!' : 'Copy link'"
                aria-label="Copy room link"
                class="copy-button"
              />
            </div>
            @if (linkCopied()) {
              <p class="copy-success-message">
                <i class="pi pi-check-circle"></i>
                Link copied to clipboard!
              </p>
            }
          </div>
          <p-button
            label="Start Drawing"
            icon="pi pi-arrow-right"
            (onClick)="closeModal()"
            class="w-full create-room-button"
            styleClass="p-button-primary"
          />
        </div>
      }
    </div>
  </p-dialog>
</div>
